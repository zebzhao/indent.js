;(function(root, factory) {
  if (typeof define === 'function' && define.amd) {
    define([], factory);
  } else if (typeof exports === 'object') {
    module.exports = factory();
  } else {
    root.indent = factory();
  }
}(this, function() {
var indent=function(){function n(n,e){return t(n,s,e)}function e(n,e){return t(n,m,e)}function t(n,e,t){function d(n){y=n.cursor,k=n.rule,I.push(k),k.indent&&u()}function c(){I.pop(),k=I[I.length-1]}function s(){p=0;for(var n,e=0;e<v.length;e++)n=v[e],n.open&&n.line!=b&&p++}function m(){x[b]=a(t,p)+A,b++,y=0,s()}function u(){var n=v[v.length-1];n&&n.line==b?n.indent++:v.push({indent:1,open:!0,line:b})}function h(){var n=v[v.length-1];n&&(n.open=b==n.line,--n.indent<=0&&v.pop())}for(var k,g,f,T=n.split(/[\r]?\n/gi),l=T.length,x=[],v=[],I=[],p=0,b=0,y=0;b<l;){var A=T[b].trim()+"\r\n",L=r(A);if(f=o(L,e,y),I.length)if(g=i(L,k,y),g.matchIndex==-1){if(k.ignore){m();continue}}else if(k.ignore||f.matchIndex==-1||g.matchIndex<=f.matchIndex){k.indent&&(h(),0==g.matchIndex&&s()),y=g.cursor,c();continue}f.matchIndex!=-1?d(f):m()}return x.join("")}function a(n,e){return new Array(e+1).join(n)}function r(n){return n.replace(/\\(u[0-9A-Za-z]{4}|u\{[0-9A-Za-z]{1,6}]\}|x[0-9A-Za-z]{2}|.)/g,"0")}function o(n,e,t){n=n.substring(t,n.length);for(var a,r,o,i=null,c=n.length,s=0;s<e.length;s++)o=e[s],r=d(n,o.startToken,o),r.matchIndex!=-1&&r.matchIndex<c&&(c=r.matchIndex,a=r,i=o);return{rule:i,matchIndex:i?c+t:-1,cursor:i?c+t+a.matchLength:-1}}function i(n,e,t){n=n.substr(t,n.length);var a=d(n,e.endToken,e),r=e.advance?a.matchIndex+a.matchLength:a.matchIndex;return{matchIndex:a.matchIndex==-1?-1:a.matchIndex+t,cursor:r==-1?-1:r+t}}function d(n,e,t){for(var a,r=-1,o=0,i=0;i<e.length;i++)if(a=e[i],"function"==typeof a){var d=a(n,t);r=d.matchIndex,o=d.length}else if(r=n.search(a),r!=-1){o=n.match(a)[0].length;break}return{matchIndex:r,matchLength:o,cursor:r+o,patternIndex:i}}var c=/\r*\n/,s=[{name:"line comment",startToken:[/\/\//],endToken:[c],ignore:!0,indent:!1},{name:"block comment",startToken:[/\/\*/],endToken:[/\*\//],ignore:!0,indent:!1},{name:"regex",startToken:[function(n,e){var t=/[(,=:[!&|?{};][\s]*\/[^\/]|^[\s]*\/[^\/]/,a=n.search(t);if(a!=-1){a=n.indexOf("/",a);var r=n.substring(a+1),o=d(r,e.endToken,e);if(o.matchIndex!=-1){r=r.substring(0,o.matchIndex);try{return new RegExp(r),{matchIndex:a,length:1}}catch(i){return{matchIndex:-1}}}}return{matchIndex:-1}}],endToken:[function(n,e){for(var t=0,a=n.indexOf("/");a!=-1;)try{new RegExp(n.substring(0,a));break}catch(r){a=n.indexOf("/",t),t=a+1}return{matchIndex:a,length:a==-1?0:1}}],ignore:!0,indent:!1,advance:!0},{name:"string",startToken:[/\"/],endToken:[/\"/,c],ignore:!0,indent:!1,advance:!0},{name:"string",startToken:[/\'/],endToken:[/\'/,c],ignore:!0,indent:!1,advance:!0},{name:"string",startToken:[/\`/],endToken:[/\`/],ignore:!0,indent:!1,advance:!0},{name:"if",startToken:[/^if[\s]*(?=\()/,/[\s]+if[\s]*(?=\()/],endToken:[/else[\s]+/,/\{/,/\;/],indent:!0},{name:"for",startToken:[/^for[\s]*(?=\()/],endToken:[/\{/,/\;/],indent:!0},{name:"else",startToken:[/else[\s]+/],endToken:[/if/,/\{/,/\;/,c],indent:!0},{name:"bracket",startToken:[/\(/],endToken:[/\)/],indent:!0,advance:!0},{name:"array",startToken:[/\[/],endToken:[/\]/],indent:!0,advance:!0},{name:"block",startToken:[/\{/],endToken:[/\}/],indent:!0,advance:!0},{name:"var",startToken:[/var[\s]+/],endToken:[/\;/],indent:!0},{name:"case",startToken:[/^case[\s]+/],endToken:[/break[\s;]+/,/^case[\s]+/,/^default[\s]+/,/\}/],indent:!0}],m=[{name:"comment",startToken:[/\<\!\-\-/],endToken:[/\-\-\>/],ignore:!0,indent:!1,advance:!0},{name:"doctype",startToken:[/\<\!/],endToken:[c],ignore:!0,indent:!1,advance:!0},{name:"link|br|input|meta",startToken:[/\<(link|br|input|meta)/i],endToken:[/(\"[^\"]*\"|'[^']*'|[^'\">])*>/],ignore:!0,indent:!1,advance:!0},{name:"tag",startToken:[/<(\"[^\"]*\"|'[^']*'|[^'\">])*>/],endToken:[/\<\/[^\>]+\>/],indent:!0,advance:!0},{name:"tag",startToken:[/<(\"[^\"]*\"|'[^']*'|[^'\">])*/],endToken:[/\/\>/],indent:!1,advance:!0}].concat(s);return{indentCSS:n,indentJS:n,indentHTML:e}}();
return indent;
}));
