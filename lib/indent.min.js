!function(n,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():n.indent=e()}(this,function(){var n=function(){function n(n,e){if(c[n])return c[n];var t=[];c[n]=t;for(var s=0;s<e.length;s++)e[s].langs.indexOf(n.toLowerCase())!=-1&&t.push(e[s]);return t}function e(e,c,d){function i(e){z=e.cursor,g=e.rule,f=e.countdown;var t=O+(g.lineOffset||0);y.push(t),b.push(g),A.push(g.countdown),g.debug,g.indent&&(u(t+1),w[t]=w[t]||0,w[t]++),g.rules&&(L=n(g.rules)),g.scope&&k.push(null)}function l(){var n=y.pop();if(g.debug,g.indent){var e=w[n]||0;if(e>0){g.matchLineIndent||(w[n]=0);var t=g.endsIndent||0!==x.matchIndex?1:0;m(O+t)}}g.rules&&(L=null),g.scope&&k.pop(),b.pop(),A.pop(),k[k.length-1]=g,g=b[b.length-1],f=A[A.length-1]}function o(){O++,z=0}function u(n,e){var t=j[n]||0;e||t<0?j[n]=t+1:0===t&&(j[n]=1)}function m(n){var e=j[n]||0;j[n]=e-1}function h(n,e,t){n=n.substring(t,n.length);for(var s,a,c,d,i=null,l=n.length,o=0;o<e.length;o++)d=e[o],c=k[k.length-1],(!d.lastRule||c&&d.lastRule.indexOf(c.name)!==-1)&&(a=r(n,d.starts,d),a.matchIndex!=-1&&a.matchIndex<l&&(!d.head||0==t)&&(l=a.matchIndex,s=a,i=d));return{rule:i,matchIndex:i?l+t:-1,cursor:i?l+t+s.matchLength:-1}}for(var g,f,x,v,p=e.split(/[\r]?\n/gi),I=p.length,j=[],w=[],b=[],y=[],k=[null],A=[],O=0,z=0,L=null;O<I;){var Z=p[O].trim(),$=s(Z)+"\r\n";if(v=h($,L||c,z),b.length)if(x=a($,g,z),x.matchIndex==-1){if(g.ignore){o();continue}f&&(f--,0===f&&l())}else if(g.ignore||v.matchIndex==-1||x.matchIndex<=v.matchIndex){l(),z=x.cursor;continue}v.matchIndex!=-1?i(v):o()}for(var R=0,C=[],S=0;S<p.length;S++)R+=j[S]||0,C.push((R>0?t(d,R):"")+p[S].trim());return console.log(j),console.log(w),C.join("\r\n")}function t(n,e){return new Array(e+1).join(n)}function s(n){return n.replace(/\\(u[0-9A-Za-z]{4}|u\{[0-9A-Za-z]{1,6}]\}|x[0-9A-Za-z]{2}|.)/g,"0")}function a(n,e,t){n=n.substr(t,n.length);var s=r(n,e.ends,e),a=e.advance?s.matchIndex+s.matchLength:s.matchIndex;return{matchIndex:s.matchIndex==-1?-1:s.matchIndex+t,cursor:a==-1?-1:a+t}}function r(n,e,t){for(var s,a=-1,r=0,c=0;c<e.length;c++)if(s=e[c],"function"==typeof s){var d=s(n,t);a=d.matchIndex,r=d.length}else if(a=n.search(s),a!=-1){r=n.match(s)[0].length;break}return{matchIndex:a,matchLength:r,cursor:a+r,patternIndex:c}}var c={},d=/\r*\n/,i=/;/,l=[{langs:"html",name:"comment",starts:[/\<\!\-\-/],ends:[/\-\-\>/],ignore:!0,advance:!0},{langs:"html",name:"doctype",starts:[/\<\!doctype html>/i],ends:[d],ignore:!0,advance:!0},{langs:"html",name:"link|br|hr|input|img|meta",starts:[/\<(link|br|hr|input|img|meta)/i],ends:[/>/],advance:!0},{langs:"html",name:"mode switch js",starts:[function(n){var e=/<script[\s>].*/i,t=/<\/script>/i,s=e.exec(n),a=t.exec(n);return s&&(!a||a.index<s.index)?{matchIndex:s.index,length:s[0].length}:{matchIndex:-1}}],ends:[/<\/script>/i],rules:"js",advance:!0,indent:!0,scope:!0},{langs:"html",name:"mode switch css",starts:[function(n){var e=/<style[\s>].*/i,t=/<\/style>/i,s=e.exec(n),a=t.exec(n);return s&&(!a||a.index<s.index)?{matchIndex:s.index,length:s[0].length}:{matchIndex:-1}}],ends:[/<\/style>/i],rules:"css",advance:!0,indent:!0,scope:!0},{langs:"html",name:"close-tag",starts:[/<\/[A-Za-z0-9\-]+>/],ends:[/./],indent:!0},{langs:"html",name:"tag-attr",starts:[/<[A-Za-z0-9\-]+/],ends:[/>/],indent:!0},{langs:"html",name:"tag",starts:[/>/],ends:[/<\/[A-Za-z0-9\-]+>/],indent:!0,advance:!0},{langs:"js",name:"line-comment",starts:[/\/\//],ends:[d],ignore:!0},{langs:"js css",name:"block-comment",starts:[/\/\*/],ends:[/\*\//],ignore:!0},{langs:"js",name:"regex",starts:[function(n,e){var t=/[(,=:[!&|?{};][\s]*\/[^\/]|^[\s]*\/[^\/]/,s=n.search(t);if(s!=-1){s=n.indexOf("/",s);var a=n.substring(s+1),c=r(a,e.ends,e);if(c.matchIndex!=-1){a=a.substring(0,c.matchIndex);try{return new RegExp(a),{matchIndex:s,length:1}}catch(d){return{matchIndex:-1}}}}return{matchIndex:-1}}],ends:[function(n){for(var e=0,t=n.indexOf("/");t!=-1;)try{new RegExp(n.substring(0,t));break}catch(s){t=n.indexOf("/",e),e=t+1}return{matchIndex:t,length:t==-1?0:1}}],ignore:!0,advance:!0},{langs:"js css html",name:"string",starts:[/\"/],ends:[/\"/,d],ignore:!0,advance:!0},{langs:"js css html",name:"string",starts:[/\'[^']/],ends:[/[^\\]\'/,d],ignore:!0,advance:!0},{langs:"js css html",name:"string",starts:[/\`[^`]/],ends:[/[^\\]\`/],ignore:!0,advance:!0},{langs:"js",name:"if",starts:[/^if[\s]*(?=\()/,/[\s]+if[\s]*(?=\()/],ends:[/else[\s]+/,/\{/,i],countdown:2,indent:!0},{langs:"js",name:"for",starts:[/^for[\s]*(?=\()/],ends:[/\{/,i],countdown:2,indent:!0},{langs:"js",name:"else",starts:[/else[\s]+/],ends:[/if/,/\{/,i],countdown:2,indent:!0},{langs:"js css",name:"bracket",starts:[/\([\s]*(var)?/],ends:[/\)/],indent:!0,advance:!0,scope:!0},{langs:"js",name:"dot-chain",starts:[/^\.[A-Za-z$_]/],ends:[d],indent:!0,head:!0,lineOffset:-1},{langs:"js",name:"dot-chain",starts:[/\.\s*$/],ends:[/[\w$]/],indent:!0},{langs:"js css",name:"array",starts:[/\[/],ends:[/]/],indent:!0,advance:!0,scope:!0},{langs:"js css",name:"block",starts:[/\{/],ends:[/}/],indent:!0,advance:!0,scope:!0},{langs:"js",name:"var/let/const",starts:[/(var|let|const)[\s]*\r*\n$/],ends:[/[\w$]/],indent:!0,endsIndent:!0},{langs:"js",name:"var/let/const",starts:[/(var|let|const)[\s]+[\w$]+/],ends:[/./]},{langs:"js",name:"var/let/const",lastRule:["var/let/const","="],starts:[/,[\s]*\r*\n$/],ends:[/./],endsIndent:!0,indent:!0},{langs:"js",name:"var/let/const",lastRule:["var/let/const","="],starts:[/^[,=]/],ends:[/[,=]/,d],head:!0,indent:!0,lineOffset:-1},{langs:"js",name:"=",starts:[/=/],ends:[/[,=]/,d],indent:!0,matchLineIndent:!0,debug:!0},{langs:"js",name:"case",starts:[/^case[\s]+/],ends:[/break[\s;]+/,/^case[\s]+/,/^default[\s]+/,/^return([\s]+|;)/,/}/],endsIndent:!0,indent:!0,scope:!0},{langs:"js",name:"default",starts:[/^default[\s]*:/],ends:[/break[\s;]+/,/^case[\s]+/,/^default[\s]+/,/^return([\s]+|;)/,/}/],endsIndent:!0,indent:!0,scope:!0},{langs:"js",name:"semicolon",starts:[i],ends:[/./]}],o=n("css",l),u=n("js",l),m=n("html",l),h={css:function(n,t){return e(n||"",o,void 0===t?"\t":t)},js:function(n,t){return e(n||"",u,void 0===t?"\t":t)},html:function(n,t){return e(n||"",m,void 0===t?"\t":t)},indentJS:function(n,e){return console&&console.warn&&console.warn("Calling deprecated function!"),h.js(n,e)},indentCSS:function(n,e){return console&&console.warn&&console.warn("Calling deprecated function!"),h.css(n,e)},indentHTML:function(n,e){return console&&console.warn&&console.warn("Calling deprecated function!"),h.html(n,e)}};return h}();return n});