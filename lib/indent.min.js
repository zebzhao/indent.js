;(function(root, factory) {
  if (typeof define === 'function' && define.amd) {
    define([], factory);
  } else if (typeof exports === 'object') {
    module.exports = factory();
  } else {
    root.indent = factory();
  }
}(this, function() {
var indent=function(){function n(n){for(var e=[],t=0;t<g.length;t++)g[t].langs.indexOf(n.toLowerCase())!=-1&&e.push(g[t]);return e}function e(e,t){return r(e,n("js"),t)}function t(e,t){return r(e,n("css"),t)}function a(e,t){return r(e,n("html"),t)}function r(n,e,t){function a(n){b=n.cursor,m=n.rule,I.push(m),m.indent&&g(m.lineOffset)}function r(){I.pop(),m=I[I.length-1]}function c(){j=0;for(var n,e=0;e<v.length;e++)n=v[e],n.open&&n.line!=p&&j++}function l(){x[p]=s(t,j)+y,p++,b=0,c()}function g(n){var e=v[v.length-1];e&&e.line==p?e.indent++:(v.push({indent:1,open:!0,line:n?p+n:p}),n<0&&c())}function h(){var n=v[v.length-1];n&&(n.open=p==n.line,--n.indent<=0&&v.pop())}for(var m,u,k,f=n.split(/[\r]?\n/gi),T=f.length,x=[],v=[],I=[],j=0,p=0,b=0;p<T;){var y=f[p].trim(),O=o(y)+"\r\n";if(k=i(O,e,b),I.length)if(u=d(O,m,b),u.matchIndex==-1){if(m.ignore){l();continue}}else if(m.ignore||k.matchIndex==-1||u.matchIndex<=k.matchIndex){m.indent&&(h(),0==u.matchIndex&&c()),b=u.cursor,r();continue}k.matchIndex!=-1?a(k):l()}return x.join("\r\n")}function s(n,e){return new Array(e+1).join(n)}function o(n){return n.replace(/\\(u[0-9A-Za-z]{4}|u\{[0-9A-Za-z]{1,6}]\}|x[0-9A-Za-z]{2}|.)/g,"0")}function i(n,e,t){n=n.substring(t,n.length);for(var a,r,s,o=null,i=n.length,d=0;d<e.length;d++)s=e[d],r=c(n,s.startToken,s),r.matchIndex!=-1&&r.matchIndex<i&&(!s.head||0==t)&&(i=r.matchIndex,a=r,o=s);return{rule:o,matchIndex:o?i+t:-1,cursor:o?i+t+a.matchLength:-1}}function d(n,e,t){n=n.substr(t,n.length);var a=c(n,e.endToken,e),r=e.advance?a.matchIndex+a.matchLength:a.matchIndex;return{matchIndex:a.matchIndex==-1?-1:a.matchIndex+t,cursor:r==-1?-1:r+t}}function c(n,e,t){for(var a,r=-1,s=0,o=0;o<e.length;o++)if(a=e[o],"function"==typeof a){var i=a(n,t);r=i.matchIndex,s=i.length}else if(r=n.search(a),r!=-1){s=n.match(a)[0].length;break}return{matchIndex:r,matchLength:s,cursor:r+s,patternIndex:o}}var l=/\r*\n/,g=[{langs:"html",name:"comment",startToken:[/\<\!\-\-/],endToken:[/\-\-\>/],ignore:!0,indent:!1,advance:!0},{langs:"html",name:"doctype",startToken:[/\<\!/],endToken:[l],ignore:!0,indent:!1,advance:!0},{langs:"html",name:"link|br|input|meta",startToken:[/\<(link|br|input|meta)/i],endToken:[/(\"[^\"]*\"|'[^']*'|[^'\">])*>/],ignore:!0,indent:!1,advance:!0},{langs:"html",name:"tag",startToken:[/<(\"[^\"]*\"|'[^']*'|[^'\">])*>/],endToken:[/\<\/[^\>]+\>/],indent:!0,advance:!0},{langs:"html",name:"tag",startToken:[/<(\"[^\"]*\"|'[^']*'|[^'\">])*/],endToken:[/\/\>/],indent:!1,advance:!0},{langs:"js",name:"line comment",startToken:[/\/\//],endToken:[l],ignore:!0,indent:!1},{langs:"js css",name:"block comment",startToken:[/\/\*/],endToken:[/\*\//],ignore:!0,indent:!1},{langs:"js",name:"regex",startToken:[function(n,e){var t=/[(,=:[!&|?{};][\s]*\/[^\/]|^[\s]*\/[^\/]/,a=n.search(t);if(a!=-1){a=n.indexOf("/",a);var r=n.substring(a+1),s=c(r,e.endToken,e);if(s.matchIndex!=-1){r=r.substring(0,s.matchIndex);try{return new RegExp(r),{matchIndex:a,length:1}}catch(o){return{matchIndex:-1}}}}return{matchIndex:-1}}],endToken:[function(n,e){for(var t=0,a=n.indexOf("/");a!=-1;)try{new RegExp(n.substring(0,a));break}catch(r){a=n.indexOf("/",t),t=a+1}return{matchIndex:a,length:a==-1?0:1}}],ignore:!0,indent:!1,advance:!0},{langs:"js css html",name:"string",startToken:[/\"/],endToken:[/\"/,l],ignore:!0,indent:!1,advance:!0},{langs:"js css html",name:"string",startToken:[/\'/],endToken:[/\'/,l],ignore:!0,indent:!1,advance:!0},{langs:"js css html",name:"string",startToken:[/\`/],endToken:[/\`/],ignore:!0,indent:!1,advance:!0},{langs:"js",name:"if",startToken:[/^if[\s]*(?=\()/,/[\s]+if[\s]*(?=\()/],endToken:[/else[\s]+/,/\{/,/;/],indent:!0},{langs:"js",name:"for",startToken:[/^for[\s]*(?=\()/],endToken:[/\{/,/;/],indent:!0},{langs:"js",name:"else",startToken:[/else[\s]+/],endToken:[/if/,/\{/,/;/,l],indent:!0},{langs:"js css",name:"bracket",startToken:[/\(/],endToken:[/\)/],indent:!0,advance:!0},{langs:"js",name:"dotchain",startToken:[/^\../],endToken:[/;/,l],indent:!0,head:!0,lineOffset:-1},{langs:"js",name:"dotchain",startToken:[/\..\s*$/],endToken:[/;/,l],indent:!0},{langs:"js css",name:"array",startToken:[/\[/],endToken:[/]/],indent:!0,advance:!0},{langs:"js css",name:"block",startToken:[/\{/],endToken:[/}/],indent:!0,advance:!0},{langs:"js",name:"var",startToken:[/var[\s]+/],endToken:[/;/],indent:!0},{langs:"js",name:"case",startToken:[/^case[\s]+/],endToken:[/break[\s;]+/,/^case[\s]+/,/^default[\s]+/,/}/],indent:!0}];return{indentCSS:t,indentJS:e,indentHTML:a}}();
return indent;
}));
