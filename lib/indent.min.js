!function(n,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():n.indent=e()}(this,function(){var n=function(n){function e(n,e){if(o[n])return o[n];var t=[];o[n]=t;for(var r=0;r<e.length;r++)e[r].a.indexOf(n.toLowerCase())!=-1&&t.push(e[r]);return t}function t(n,t,c){function l(n){O=n.cursor;var t=n.rule,r=Z+1+(t.b||0);n.line=r,A.push(n),t.c&&y[r]++,t.d&&(P=e(t.d,g)),t.e&&z.push(null),t.callback&&t.callback(n,y,w)}function o(){var n=A.pop(),e=n.line,t=n.rule;if(t.c){var r="function"==typeof t.f?t.f(d):t.f,a=r||0!==d.matchIndex?1:0;w[Z+a]&&w[Z+a].push(e)}t.d&&(P=null),t.e&&z.pop(),z[z.length-1]=n}function h(n,e,t){n=n.substring(t,n.length);for(var r,a,i,s=null,c=n.length,l=z[z.length-1],o=l?l.rule.g:"",h=0;h<e.length;h++)i=e[h],(!i.h||o&&i.h.indexOf(o)!==-1)&&(a=u(n,i.i,i),a.matchIndex!=-1&&a.matchIndex<c&&(!i.j||0==t)&&(c=a.matchIndex,r=a,s=i));return{rule:s,relativeIndex:s?c:-1,matchIndex:s?c+t:-1,cursor:s?t+r.cursor:-1,state:r?r.state:{},lastMatch:l}}function f(n,e,t,r){n=n.substr(t,n.length);var a=e.rule,i=u(n,a.k,a,e.state,r),s=a.l?i.cursor:i.matchIndex;return{endPatternIndex:i.endPatternIndex,matchIndex:i.matchIndex===-1?-1:i.matchIndex+t,cursor:s==-1?-1:s+t,state:i.state}}n=n||"";var d,m,x,k,v,j=void 0===c.tabString?"\t":c.tabString,I=n.split(/[\r]?\n/gi),p=I.length,b=a(p),y=a(p),w=r(p),A=[],z=[null],Z=0,O=0,P=null;for(c.debug={buffers:{ignore:b,indent:y,dedent:w,active:A}};Z<p;){if(x=I[Z].trim(),k=s(x)+"\r\n",v=A[A.length-1],m=h(k,P||t,O),A.length)if(d=f(k,v,O,m),d.matchIndex===-1){if(v.rule.m){b[Z]=1,Z++,O=0;continue}}else if(v.rule.m||m.matchIndex===-1||d.matchIndex<=m.matchIndex){o(),O=d.cursor;continue}m.matchIndex!==-1?l(m):(Z++,O=0)}var q,E,R,$,M,S,T=0,C=y.slice(),L=a(p),_=[];for(M=0;M<p;M++){for(E=w[M],$=0,S=0;S<E.length;S++)R=E[S],R<0?-R!==M&&(L[-R]++,$+=1):C[R]>0&&(C[R]--,$+=R!==M);q=C[M],L[M]=q>$?1:q<$?q-$:0,C[M]=q>0?1:0}for(M=0;M<p;M++)0===b[M]?(T+=L[M]||0,_.push((T>0?i(j,T):"")+I[M].trim())):_.push(I[M]);return _.join("\r\n")}function r(n){for(var e=new Array(n),t=0;t<n;t++)e[t]=[];return e}function a(e){if(n.Int16Array)return new Int16Array(e);for(var t=new Array(e),r=0;r<e;r++)t[r]=0;return t}function i(n,e){return new Array(e+1).join(n)}function s(n){return n.replace(/\\(u[0-9A-Za-z]{4}|u\{[0-9A-Za-z]{1,6}]\}|x[0-9A-Za-z]{2}|.)/g,"0")}function c(n,e,t){var r=n.lastMatch;r&&"="===r.rule.g&&t[n.line].push(-r.line)}function l(n,e,t,r){var a;if(t.newline){if(a=n.search(/[;,=]?\r*\n/),a!==-1)return{matchIndex:a,length:1}}else a=n.search(/[^\s\r\n\{\(\[]/),t.newline=a!==-1&&(a<=r.relativeIndex||r.relativeIndex===-1);return null}function u(n,e,t,r,a){r=r||{};for(var i,s,c=-1,l=0,u=0;u<e.length;u++)if(s=e[u],"function"==typeof s){if(i=s(n,t,r,a)){c=i.matchIndex,l=i.length;break}}else if(i=n.match(s)){c=n.search(s),l=i[0].length;break}return{endPatternIndex:u,matchIndex:c,cursor:c+l,state:r}}var o={},h=/\r*\n/,g=[{a:"html",g:"comment",i:[/\<\!\-\-/],k:[/\-\-\>/],m:!0,l:!0},{a:"html",g:"doctype",i:[/\<\!doctype html>/i],k:[h],m:!0,l:!0},{a:"html",g:"void-tags",i:[/\<(area|base|br|col|command|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)/i],k:[/>/],c:!0,l:!0},{a:"html",g:"mode switch js",i:[function(n){var e=/<script[\s>].*/i,t=/<\/script>/i,r=e.exec(n),a=t.exec(n);return r&&(!a||a.index<r.index)?{matchIndex:r.index,length:r[0].length}:null}],k:[/<\/script>/i],d:"js",l:!0,c:!0,e:!0},{a:"html",g:"mode switch css",i:[function(n){var e=/<style[\s>].*/i,t=/<\/style>/i,r=e.exec(n),a=t.exec(n);return r&&(!a||a.index<r.index)?{matchIndex:r.index,length:r[0].length}:null}],k:[/<\/style>/i],d:"css",l:!0,c:!0,e:!0},{a:"html",g:"html-tag",i:[/<html[^A-Za-z0-9]/i],k:[/<\/html>/i],l:!0},{a:"html",g:"tag",i:[function(n,e,t){var r=/<([A-Za-z0-9\-]+)/,a=n.match(r);return a?(t.openingTag=a[1],{matchIndex:a.index,length:a[0].length}):null}],k:[function(n,e,t){var r=new RegExp("</"+t.openingTag+">","i"),a=n.match(r);return a?{matchIndex:a.index,length:a[0].length}:null}],c:!0,l:!0},{a:"js",g:"line-comment",i:[/\/\//],k:[h],m:!0},{a:"js css",g:"block-comment",i:[/\/\*/],k:[/\*\//],m:!0},{a:"js",g:"regex",i:[function(n,e){var t=/[(,=:[!&|?{};][\s]*\/[^\/]|^[\s]*\/[^\/]/,r=n.search(t);if(r!=-1){r=n.indexOf("/",r);var a=n.substring(r+1),i=u(a,e.k,e);if(i.matchIndex!=-1){a=a.substring(0,i.matchIndex);try{return new RegExp(a),{matchIndex:r,length:1}}catch(s){return null}}}return null}],k:[function(n){for(var e=0,t=n.indexOf("/");t!=-1;)try{new RegExp(n.substring(0,t));break}catch(r){t=n.indexOf("/",e),e=t+1}return t==-1?null:{matchIndex:t,length:1}}],m:!0,l:!0},{a:"html",g:"quotes",i:[/"/],k:[/"/,h],m:!0,l:!0},{a:"html",g:"quotes",i:[/'/],k:[/'/,h],m:!0,l:!0},{a:"js css",g:"string",i:[/(''|""|``)/],k:[/./,h]},{a:"js css",g:"string",i:[/\"(?=[^"])/],k:[/[^\\]\"/,h],m:!0,l:!0},{a:"js css",g:"string",i:[/\'(?=[^'])/],k:[/[^\\]\'/,h],m:!0,l:!0},{a:"js css",g:"string",i:[/\`(?=[^`])/],k:[/[^\\]\`/],m:!0,l:!0},{a:"js",g:"if",i:[/^if\s*(?=\()/,/[\s]+if\s*(?=\()/],k:[/else[\s]+/,l,/[{;]/],c:!0},{a:"js",g:"for|while",i:[/^(for|while)\s*(?=\()/],k:[l,/[{;]/],c:!0},{a:"js",g:"else",i:[/else[\s]+/],k:[/if[^\w$]/,l,/[{;]/],c:!0},{a:"js css",g:"bracket",i:[/\(\s*(var|let|const)?\s*/],k:[/\)/],c:!0,l:!0,e:!0},{a:"js",g:"dot-chain",i:[/^\.[A-Za-z$_]/],k:[/[\.;]/],c:!0,j:!0,b:-1},{a:"js",g:"dot-chain",i:[/\.\s*\r*\n/],k:[/[\.;]/,/[^\s]\s*\r*\n/],c:!0},{a:"js css",g:"array",i:[/\[/],k:[/]/],c:!0,l:!0,e:!0},{a:"js css",g:"block",i:[/\{/],k:[/}/],c:!0,l:!0,e:!0},{a:"js",g:"var/let/const",i:[/(var|let|const)[\s]*\r*\n/],k:[l],c:!0,f:!0},{a:"js",g:"var/let/const",i:[/(var|let|const)\s+(?=[\w$])/],k:[/[,;=]/,l],c:!0},{a:"js",g:"var/let/const",h:["var/let/const","="],i:[/,[\s]*\r*\n/],k:[/[,;]/,l],c:!0,callback:c},{a:"js",g:"var/let/const",h:["var/let/const","="],i:[/^,/],k:[/[,;]/,l],j:!0,c:!0,b:-1,callback:c},{a:"js",g:"equality",i:[/[=<>!]=(=)?/],k:[/./]},{a:"js",g:"=",i:[/=/],k:[/[,;\)\]}]/,h]},{a:"js",g:"?:",i:[/\?/],k:[/[:;]/],f:!0,c:!0},{a:"js",g:"case",i:[/^(case|default)[\s:]/],k:[/break[\s;\r\n]/,/^return[\s;\r\n]/,/^case[\s]+/,/^default[\s:]/,/}/],f:function(n){return n.endPatternIndex<=1},c:!0,e:!0},{a:"js",g:"semicolon",i:[/;/],k:[/./]}];return{css:function(n,r){return t(n,e("css",g,r),r)},js:function(n,r){return t(n,e("js",g,r),r)},ts:function(n,r){return t(n,e("js",g,r),r)},html:function(n,r){return t(n,e("html",g,r),r)}}}(this);return n});