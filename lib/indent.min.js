!function(n,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():n.indent=e()}(this,function(){var n=function(){function n(n,e){if(r[n])return r[n];var t=[];r[n]=t;for(var a=0;a<e.length;a++)e[a].langs.indexOf(n.toLowerCase())!=-1&&t.push(e[a]);return t}function e(e,r,c){function d(e){z=e.cursor,k=e.rule,f=e.countdown,b.push(k),y.push(k.countdown),k.indent&&m(k.lineOffset),k.rules&&(R=n(k.rules)),k.debug}function i(){k.indent&&(h(),k.endTokenIndent||0!=x.matchIndex||l()),k.rules&&(R=null),b.pop(),y.pop(),T=k,k=b[b.length-1],f=y[y.length-1]}function l(){A=0;for(var n,e=0;e<w.length;e++)n=w[e],n.open&&n.line!=O&&A++}function u(){j[O]=t(c,A)+Z,O++,z=0,l()}function m(n){var e=w[w.length-1];e&&e.line==O?e.indent++:(w.push({indent:1,open:!0,line:n?O+n:O}),n<0&&l())}function h(){var n=w[w.length-1];n&&(n.open=O==n.line,--n.indent<=0&&w.pop())}function g(n,e,t){n=n.substring(t,n.length);for(var a,s,r,c=null,d=n.length,i=0;i<e.length;i++)r=e[i],(!r.lastRule||T&&T.name===r.lastRule)&&(s=o(n,r.startToken,r),s.matchIndex!=-1&&s.matchIndex<d&&(!r.head||0==t)&&(d=s.matchIndex,a=s,c=r));return{rule:c,matchIndex:c?d+t:-1,cursor:c?d+t+a.matchLength:-1}}for(var k,f,T,x,v,I=e.split(/[\r]?\n/gi),p=I.length,j=[],w=[],b=[],y=[],A=0,O=0,z=0,R=null;O<p;){var Z=I[O].trim(),C=a(Z)+"\r\n";if(v=g(C,R||r,z),b.length)if(x=s(C,k,z),x.matchIndex==-1){if(k.ignore){u();continue}f&&(f--,0===f&&i())}else if(k.ignore||v.matchIndex==-1||x.matchIndex<=v.matchIndex){i(),z=x.cursor;continue}v.matchIndex!=-1?d(v):u()}return j.join("\r\n")}function t(n,e){return new Array(e+1).join(n)}function a(n){return n.replace(/\\(u[0-9A-Za-z]{4}|u\{[0-9A-Za-z]{1,6}]\}|x[0-9A-Za-z]{2}|.)/g,"0")}function s(n,e,t){n=n.substr(t,n.length);var a=o(n,e.endToken,e),s=e.advance?a.matchIndex+a.matchLength:a.matchIndex;return{matchIndex:a.matchIndex==-1?-1:a.matchIndex+t,cursor:s==-1?-1:s+t}}function o(n,e,t){for(var a,s=-1,o=0,r=0;r<e.length;r++)if(a=e[r],"function"==typeof a){var c=a(n,t);s=c.matchIndex,o=c.length}else if(s=n.search(a),s!=-1){o=n.match(a)[0].length;break}return{matchIndex:s,matchLength:o,cursor:s+o,patternIndex:r}}var r={},c=/\r*\n/,d=/;/,i=[{langs:"html",name:"comment",startToken:[/\<\!\-\-/],endToken:[/\-\-\>/],ignore:!0,advance:!0},{langs:"html",name:"doctype",startToken:[/\<\!doctype html>/i],endToken:[c],ignore:!0,advance:!0},{langs:"html",name:"link|br|hr|input|img|meta",startToken:[/\<(link|br|hr|input|img|meta)/i],endToken:[/>/],advance:!0},{langs:"html",name:"mode switch js",startToken:[function(n){var e=/<script[\s>].*/i,t=/<\/script>/i,a=e.exec(n),s=t.exec(n);return a&&(!s||s.index<a.index)?{matchIndex:a.index,length:a[0].length}:{matchIndex:-1}}],endToken:[/<\/script>/i],rules:"js",advance:!0,indent:!0},{langs:"html",name:"mode switch css",startToken:[function(n){var e=/<style[\s>].*/i,t=/<\/style>/i,a=e.exec(n),s=t.exec(n);return a&&(!s||s.index<a.index)?{matchIndex:a.index,length:a[0].length}:{matchIndex:-1}}],endToken:[/<\/style>/i],rules:"css",advance:!0,indent:!0},{langs:"html",name:"close-tag",startToken:[/<\/[A-Za-z0-9\-]+>/],endToken:[/./],indent:!0},{langs:"html",name:"tag attr",startToken:[/<[A-Za-z0-9\-]+/],endToken:[/>/],indent:!0},{langs:"html",name:"tag",startToken:[/>/],endToken:[/<\/[A-Za-z0-9\-]+>/],indent:!0,advance:!0},{langs:"js",name:"line comment",startToken:[/\/\//],endToken:[c],ignore:!0},{langs:"js css",name:"block comment",startToken:[/\/\*/],endToken:[/\*\//],ignore:!0},{langs:"js",name:"regex",startToken:[function(n,e){var t=/[(,=:[!&|?{};][\s]*\/[^\/]|^[\s]*\/[^\/]/,a=n.search(t);if(a!=-1){a=n.indexOf("/",a);var s=n.substring(a+1),r=o(s,e.endToken,e);if(r.matchIndex!=-1){s=s.substring(0,r.matchIndex);try{return new RegExp(s),{matchIndex:a,length:1}}catch(c){return{matchIndex:-1}}}}return{matchIndex:-1}}],endToken:[function(n){for(var e=0,t=n.indexOf("/");t!=-1;)try{new RegExp(n.substring(0,t));break}catch(a){t=n.indexOf("/",e),e=t+1}return{matchIndex:t,length:t==-1?0:1}}],ignore:!0,advance:!0},{langs:"js css html",name:"string",startToken:[/\"/],endToken:[/\"/,c],ignore:!0,advance:!0},{langs:"js css html",name:"string",startToken:[/\'[^']/],endToken:[/[^\\]\'/,c],ignore:!0,advance:!0},{langs:"js css html",name:"string",startToken:[/\`[^`]/],endToken:[/[^\\]\`/],ignore:!0,advance:!0},{langs:"js",name:"if",startToken:[/^if[\s]*(?=\()/,/[\s]+if[\s]*(?=\()/],endToken:[/else[\s]+/,/\{/,d],countdown:2,indent:!0},{langs:"js",name:"for",startToken:[/^for[\s]*(?=\()/],endToken:[/\{/,d],countdown:2,indent:!0},{langs:"js",name:"else",startToken:[/else[\s]+/],endToken:[/if/,/\{/,d],countdown:2,indent:!0},{langs:"js css",name:"bracket",startToken:[/\([\s]*(var)?/],endToken:[/\)/],indent:!0,advance:!0},{langs:"js",name:"dot-chain",startToken:[/^\../],endToken:[d,c],indent:!0,head:!0,lineOffset:-1},{langs:"js",name:"dot-chain",startToken:[/\.\s*$/],endToken:[function(n){return{matchIndex:n.length?1:-1,length:n.length?0:1}}],indent:!0},{langs:"js css",name:"array",startToken:[/\[/],endToken:[/]/],indent:!0,advance:!0},{langs:"js css",name:"block",startToken:[/\{/],endToken:[/}/],indent:!0,advance:!0},{langs:"js",name:"var/let/const",startToken:[/(var|let|const)[\s]*$/],endToken:[/./],indent:!0,endTokenIndent:!0},{langs:"js",name:"var/let/const",startToken:[/(var|let|const)[\s]+[\w$]+/],endToken:[/./]},{langs:"js",name:"var/let/const",lastRule:"var/let/const",startToken:[/,[\s]*\r*\n$/],endToken:[/./],endTokenIndent:!0,indent:!0},{langs:"js",name:"var/let/const",lastRule:"var/let/const",startToken:[/^,/],endToken:[/./],head:!0,indent:!0,lineOffset:-1},{langs:"js",name:"case",startToken:[/^case[\s]+/],endToken:[/break[\s;]+/,/^case[\s]+/,/^default[\s]+/,/^return([\s]+|;)/,/}/],endTokenIndent:!0,indent:!0},{langs:"js",name:"default",startToken:[/^default[\s]*:/],endToken:[/break[\s;]+/,/^case[\s]+/,/^default[\s]+/,/^return([\s]+|;)/,/}/],endTokenIndent:!0,indent:!0},{langs:"js",name:"semicolon",startToken:[d],endToken:[/./]}],l=n("css",i),u=n("js",i),m=n("html",i),h={css:function(n,t){return e(n||"",l,void 0===t?"\t":t)},js:function(n,t){return e(n||"",u,void 0===t?"\t":t)},html:function(n,t){return e(n||"",m,void 0===t?"\t":t)},indentJS:function(n,e){return console&&console.warn&&console.warn("Calling deprecated function!"),h.js(n,e)},indentCSS:function(n,e){return console&&console.warn&&console.warn("Calling deprecated function!"),h.css(n,e)},indentHTML:function(n,e){return console&&console.warn&&console.warn("Calling deprecated function!"),h.html(n,e)}};return h}();return n});