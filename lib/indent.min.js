!function(n,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():n.indent=e()}(this,function(){var n=function(n){function e(n,e){if(h[n])return h[n];var t=[];h[n]=t;for(var r=0;r<e.length;r++)e[r].a.indexOf(n.toLowerCase())!=-1&&t.push(e[r]);return t}function t(n,t,a){function i(n){z=n.cursor;var t=n.rule,r=A+1+(t.b||0);n.line=r,w.push(n),t.c&&k[r]++,t.d&&(Z=e(t.d)),t.e&&y.push(null),t.callback&&t.callback(n,k,b)}function h(){var n=w.pop(),e=n.line,t=n.rule;if(t.c){var r="function"==typeof t.f?t.f(g):t.f,l=r||0!==g.matchIndex?1:0;b[A+l]&&b[A+l].push(e)}t.d&&(Z=null),t.e&&y.pop(),y[y.length-1]=n}function f(n,e,t){n=n.substring(t,n.length);for(var r,l,c,s=null,a=n.length,i=y[y.length-1],o=i?i.rule.g:"",h=0;h<e.length;h++)c=e[h],(!c.h||o&&c.h.indexOf(o)!==-1)&&(l=u(n,c.i,c),l.matchIndex!=-1&&l.matchIndex<a&&(!c.j||0==t)&&(a=l.matchIndex,r=l,s=c));return{rule:s,relativeIndex:s?a:-1,matchIndex:s?a+t:-1,cursor:s?t+r.cursor:-1,state:l.state,lastMatch:i}}for(var g,d,m,x,v,j=n.split(/[\r]?\n/gi),I=j.length,p=l(I),k=l(I),b=r(I),w=[],y=[null],A=0,z=0,Z=null;A<I;){if(m=j[A].trim(),x=s(m)+"\r\n",v=w[w.length-1],d=f(x,Z||t,z),w.length)if(g=o(x,v,z,d),g.matchIndex===-1){if(v.rule.k){p[A]=1,A++,z=0;continue}}else if(v.rule.k||d.matchIndex===-1||g.matchIndex<=d.matchIndex){h(),z=g.cursor;continue}d.matchIndex!==-1?i(d):(A++,z=0)}console.log(b),console.log(k),console.log(p),console.log(w);var C,O,P,M,S,$,E=0,L=k.slice(),R=l(I),q=[];for(S=0;S<I;S++){for(O=b[S],M=0,$=0;$<O.length;$++)P=O[$],P<0?-P!==S&&(R[-P]++,M+=1):L[P]>0&&(L[P]--,M+=P!==S);C=L[S],R[S]=C>M?1:C<M?C-M:0,L[S]=C>0?1:0}for(S=0;S<I;S++)0===p[S]?(E+=R[S]||0,q.push((E>0?c(a,E):"")+j[S].trim())):q.push(j[S]);return console.log(L),console.log(R),q.join("\r\n")}function r(n){for(var e=new Array(n),t=0;t<n;t++)e[t]=[];return e}function l(e){if(n.Int16Array)return new Int16Array(e);for(var t=new Array(e),r=0;r<e;r++)t[r]=0;return t}function c(n,e){return new Array(e+1).join(n)}function s(n){return n.replace(/\\(u[0-9A-Za-z]{4}|u\{[0-9A-Za-z]{1,6}]\}|x[0-9A-Za-z]{2}|.)/g,"0")}function a(n,e,t){var r=n.lastMatch;r&&"="===r.rule.g&&t[n.line].push(-r.line)}function i(n,e,t,r){var l;if(t.newline){if(l=n.search(/[;,=]?\r*\n/),l!==-1)return{matchIndex:l,length:1}}else l=n.search(/[^\s\r\n\{\(\[]/),t.newline=l!==-1&&(l<=r.relativeIndex||r.relativeIndex===-1);return null}function o(n,e,t,r){n=n.substr(t,n.length);var l=e.rule,c=u(n,l.l,l,e.state,r),s=l.m?c.cursor:c.matchIndex;return{endPatternIndex:c.endPatternIndex,matchIndex:c.matchIndex===-1?-1:c.matchIndex+t,cursor:s==-1?-1:s+t,state:c.state}}function u(n,e,t,r,l){r=r||{};for(var c,s,a=-1,i=0,o=0;o<e.length;o++)if(s=e[o],"function"==typeof s){if(c=s(n,t,r,l)){a=c.matchIndex,i=c.length;break}}else if(c=n.match(s)){a=n.search(s),i=c[0].length;break}return{endPatternIndex:o,matchIndex:a,cursor:a+i,state:r}}var h={},f=/\r*\n/,g=[{a:"html",g:"comment",i:[/\<\!\-\-/],l:[/\-\-\>/],k:!0,m:!0},{a:"html",g:"doctype",i:[/\<\!doctype html>/i],l:[f],k:!0,m:!0},{a:"html",g:"link|br|hr|input|img|meta",i:[/\<(link|br|hr|input|img|meta)/i],l:[/>/],m:!0},{a:"html",g:"mode switch js",i:[function(n){var e=/<script[\s>].*/i,t=/<\/script>/i,r=e.exec(n),l=t.exec(n);return r&&(!l||l.index<r.index)?{matchIndex:r.index,length:r[0].length}:null}],l:[/<\/script>/i],d:"js",m:!0,c:!0,e:!0},{a:"html",g:"mode switch css",i:[function(n){var e=/<style[\s>].*/i,t=/<\/style>/i,r=e.exec(n),l=t.exec(n);return r&&(!l||l.index<r.index)?{matchIndex:r.index,length:r[0].length}:null}],l:[/<\/style>/i],d:"css",m:!0,c:!0,e:!0},{a:"html",g:"close-tag",i:[/<\/[A-Za-z0-9\-]+>/],l:[/./],c:!0},{a:"html",g:"tag-attr",i:[/<[A-Za-z0-9\-]+/],l:[/>/],c:!0},{a:"html",g:"tag",i:[/>/],l:[/<\/[A-Za-z0-9\-]+>/],c:!0,m:!0},{a:"js",g:"line-comment",i:[/\/\//],l:[f],k:!0},{a:"js css",g:"block-comment",i:[/\/\*/],l:[/\*\//],k:!0},{a:"js",g:"regex",i:[function(n,e){var t=/[(,=:[!&|?{};][\s]*\/[^\/]|^[\s]*\/[^\/]/,r=n.search(t);if(r!=-1){r=n.indexOf("/",r);var l=n.substring(r+1),c=u(l,e.l,e);if(c.matchIndex!=-1){l=l.substring(0,c.matchIndex);try{return new RegExp(l),{matchIndex:r,length:1}}catch(s){return null}}}return null}],l:[function(n){for(var e=0,t=n.indexOf("/");t!=-1;)try{new RegExp(n.substring(0,t));break}catch(r){t=n.indexOf("/",e),e=t+1}return t==-1?null:{matchIndex:t,length:1}}],k:!0,m:!0},{a:"js css html",g:"string",i:[/(''|""|``)/],l:[/./,f]},{a:"js css html",g:"string",i:[/\"(?=[^"])/],l:[/[^\\]\"/,f],k:!0,m:!0},{a:"js css html",g:"string",i:[/\'(?=[^'])/],l:[/[^\\]\'/,f],k:!0,m:!0},{a:"js css html",g:"string",i:[/\`(?=[^`])/],l:[/[^\\]\`/],k:!0,m:!0},{a:"js",g:"if",i:[/^if\s*(?=\()/,/[\s]+if\s*(?=\()/],l:[/else[\s]+/,i,/[{;]/],c:!0},{a:"js",g:"for",i:[/^for\s*(?=\()/],l:[i,/[{;]/],c:!0},{a:"js",g:"else",i:[/else[\s]+/],l:[/if[^\w$]/,i,/[{;]/],c:!0},{a:"js css",g:"bracket",i:[/\(/],l:[/\)/],c:!0,m:!0,e:!0},{a:"js",g:"dot-chain",i:[/^\.[A-Za-z$_]/],l:[/[\.;]/],c:!0,j:!0,b:-1},{a:"js",g:"dot-chain",i:[/\.\s*\r*\n/],l:[/[\.;]/,/[^\s]\s*\r*\n/],c:!0},{a:"js css",g:"array",i:[/\[/],l:[/]/],c:!0,m:!0,e:!0},{a:"js css",g:"block",i:[/\{/],l:[/}/],c:!0,m:!0,e:!0},{a:"js",g:"var/let/const",i:[/(var|let|const)[\s]*\r*\n/],l:[i],c:!0,f:!0},{a:"js",g:"var/let/const",i:[/(var|let|const)\s+(?=[\w$])/],l:[/[,;=]/,i],c:!0},{a:"js",g:"var/let/const",h:["var/let/const","="],i:[/,[\s]*\r*\n/],l:[/[,;]/,i],c:!0,callback:a},{a:"js",g:"var/let/const",h:["var/let/const","="],i:[/^,/],l:[/[,;]/,i],j:!0,c:!0,b:-1,callback:a},{a:"js",g:"equality",i:[/[=<>!]=(=)?/],l:[/./]},{a:"js",g:"=",i:[/=/],l:[/[,;]/,f]},{a:"js",g:"case",i:[/^(case|default)[\s:]/],l:[/break[\s;\r\n]/,/^return[\s;\r\n]/,/^case[\s]+/,/^default[\s:]/,/}/],f:function(n){return n.endPatternIndex<=1},c:!0,e:!0},{a:"js",g:"semicolon",i:[/;/],l:[/./]}],d=e("css",g),m=e("js",g),x=e("html",g),v={css:function(n,e){return t(n||"",d,void 0===e?"\t":e)},js:function(n,e){return t(n||"",m,void 0===e?"\t":e)},html:function(n,e){return t(n||"",x,void 0===e?"\t":e)},indentJS:function(n,e){return console&&console.warn&&console.warn("Calling deprecated function!"),v.js(n,e)},indentCSS:function(n,e){return console&&console.warn&&console.warn("Calling deprecated function!"),v.css(n,e)},indentHTML:function(n,e){return console&&console.warn&&console.warn("Calling deprecated function!"),v.html(n,e)}};return v}(this);return n});