!function(n,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():n.indent=e()}(this,function(){var n=function(n){function e(n,e){if(u[n])return u[n];var t=[];u[n]=t;for(var r=0;r<e.length;r++)e[r].a.indexOf(n.toLowerCase())!=-1&&t.push(e[r]);return t}function t(n,t,l){function i(n){z=n.cursor;var t=n.rule,r=A+1+(t.b||0);n.line=r,w.push(n),t.c&&I[r]++,t.d&&(Z=e(t.d)),t.e&&y.push(null),t.callback&&t.callback(n,I,b)}function u(){var n=w.pop(),e=n.line,t=n.rule;if(t.c){var r="function"==typeof t.f?t.f(f):t.f,c=r||0!==f.matchIndex?1:0;b[A+c]&&b[A+c].push(e)}t.d&&(Z=null),t.e&&y.pop(),y[y.length-1]=n}function h(n,e,t){n=n.substring(t,n.length);for(var r,c,a,s=null,l=n.length,i=y[y.length-1],u=i?i.rule.g:"",h=0;h<e.length;h++)a=e[h],(!a.h||u&&a.h.indexOf(u)!==-1)&&(c=o(n,a.i,a),c.matchIndex!=-1&&c.matchIndex<l&&(!a.j||0==t)&&(l=c.matchIndex,r=c,s=a));return{rule:s,relativeIndex:s?l:-1,matchIndex:s?l+t:-1,cursor:s?t+r.cursor:-1,state:r?r.state:{},lastMatch:i}}function g(n,e,t,r){n=n.substr(t,n.length);var c=e.rule,a=o(n,c.k,c,e.state,r),s=c.l?a.cursor:a.matchIndex;return{endPatternIndex:a.endPatternIndex,matchIndex:a.matchIndex===-1?-1:a.matchIndex+t,cursor:s==-1?-1:s+t,state:a.state}}for(var f,d,m,x,k,v=n.split(/[\r]?\n/gi),j=v.length,p=c(j),I=c(j),b=r(j),w=[],y=[null],A=0,z=0,Z=null;A<j;){if(m=v[A].trim(),x=s(m)+"\r\n",k=w[w.length-1],d=h(x,Z||t,z),w.length)if(f=g(x,k,z,d),f.matchIndex===-1){if(k.rule.m){p[A]=1,A++,z=0;continue}}else if(k.rule.m||d.matchIndex===-1||f.matchIndex<=d.matchIndex){u(),z=f.cursor;continue}d.matchIndex!==-1?i(d):(A++,z=0)}console.log(b),console.log(I),console.log(p),console.log(w);var C,O,P,T,q,E,M=0,R=I.slice(),S=c(j),$=[];for(q=0;q<j;q++){for(O=b[q],T=0,E=0;E<O.length;E++)P=O[E],P<0?-P!==q&&(S[-P]++,T+=1):R[P]>0&&(R[P]--,T+=P!==q);C=R[q],S[q]=C>T?1:C<T?C-T:0,R[q]=C>0?1:0}for(q=0;q<j;q++)0===p[q]?(M+=S[q]||0,$.push((M>0?a(l,M):"")+v[q].trim())):$.push(v[q]);return console.log(R),console.log(S),$.join("\r\n")}function r(n){for(var e=new Array(n),t=0;t<n;t++)e[t]=[];return e}function c(e){if(n.Int16Array)return new Int16Array(e);for(var t=new Array(e),r=0;r<e;r++)t[r]=0;return t}function a(n,e){return new Array(e+1).join(n)}function s(n){return n.replace(/\\(u[0-9A-Za-z]{4}|u\{[0-9A-Za-z]{1,6}]\}|x[0-9A-Za-z]{2}|.)/g,"0")}function l(n,e,t){var r=n.lastMatch;r&&"="===r.rule.g&&t[n.line].push(-r.line)}function i(n,e,t,r){var c;if(t.newline){if(c=n.search(/[;,=]?\r*\n/),c!==-1)return{matchIndex:c,length:1}}else c=n.search(/[^\s\r\n\{\(\[]/),t.newline=c!==-1&&(c<=r.relativeIndex||r.relativeIndex===-1);return null}function o(n,e,t,r,c){r=r||{};for(var a,s,l=-1,i=0,o=0;o<e.length;o++)if(s=e[o],"function"==typeof s){if(a=s(n,t,r,c)){l=a.matchIndex,i=a.length;break}}else if(a=n.match(s)){l=n.search(s),i=a[0].length;break}return{endPatternIndex:o,matchIndex:l,cursor:l+i,state:r}}var u={},h=/\r*\n/,g=[{a:"html",g:"comment",i:[/\<\!\-\-/],k:[/\-\-\>/],m:!0,l:!0},{a:"html",g:"doctype",i:[/\<\!doctype html>/i],k:[h],m:!0,l:!0},{a:"html",g:"void-tags",i:[/\<(area|base|br|col|command|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)/i],k:[/>/],c:!0,l:!0},{a:"html",g:"mode switch js",i:[function(n){var e=/<script[\s>].*/i,t=/<\/script>/i,r=e.exec(n),c=t.exec(n);return r&&(!c||c.index<r.index)?{matchIndex:r.index,length:r[0].length}:null}],k:[/<\/script>/i],d:"js",l:!0,c:!0,e:!0},{a:"html",g:"mode switch css",i:[function(n){var e=/<style[\s>].*/i,t=/<\/style>/i,r=e.exec(n),c=t.exec(n);return r&&(!c||c.index<r.index)?{matchIndex:r.index,length:r[0].length}:null}],k:[/<\/style>/i],d:"css",l:!0,c:!0,e:!0},{a:"html",g:"html-tag",i:[/<html[^A-Za-z0-9]/i],k:[/<\/html>/i],l:!0},{a:"html",g:"tag",i:[function(n,e,t){var r=/<([A-Za-z0-9\-]+)/,c=n.match(r);return c?(t.openingTag=c[1],{matchIndex:c.index,length:c[0].length}):null}],k:[function(n,e,t){var r=new RegExp("</"+t.openingTag+">","i"),c=n.match(r);return console.log(t.openingTag,c),c?{matchIndex:c.index,length:c[0].length}:null}],c:!0,l:!0},{a:"js",g:"line-comment",i:[/\/\//],k:[h],m:!0},{a:"js css",g:"block-comment",i:[/\/\*/],k:[/\*\//],m:!0},{a:"js",g:"regex",i:[function(n,e){var t=/[(,=:[!&|?{};][\s]*\/[^\/]|^[\s]*\/[^\/]/,r=n.search(t);if(r!=-1){r=n.indexOf("/",r);var c=n.substring(r+1),a=o(c,e.k,e);if(a.matchIndex!=-1){c=c.substring(0,a.matchIndex);try{return new RegExp(c),{matchIndex:r,length:1}}catch(s){return null}}}return null}],k:[function(n){for(var e=0,t=n.indexOf("/");t!=-1;)try{new RegExp(n.substring(0,t));break}catch(r){t=n.indexOf("/",e),e=t+1}return t==-1?null:{matchIndex:t,length:1}}],m:!0,l:!0},{a:"html",g:"quotes",i:[/"/],k:[/"/,h],m:!0,l:!0},{a:"html",g:"quotes",i:[/'/],k:[/'/,h],m:!0,l:!0},{a:"js css",g:"string",i:[/(''|""|``)/],k:[/./,h]},{a:"js css",g:"string",i:[/\"(?=[^"])/],k:[/[^\\]\"/,h],m:!0,l:!0},{a:"js css",g:"string",i:[/\'(?=[^'])/],k:[/[^\\]\'/,h],m:!0,l:!0},{a:"js css",g:"string",i:[/\`(?=[^`])/],k:[/[^\\]\`/],m:!0,l:!0},{a:"js",g:"if",i:[/^if\s*(?=\()/,/[\s]+if\s*(?=\()/],k:[/else[\s]+/,i,/[{;]/],c:!0},{a:"js",g:"for|while",i:[/^(for|while)\s*(?=\()/],k:[i,/[{;]/],c:!0},{a:"js",g:"else",i:[/else[\s]+/],k:[/if[^\w$]/,i,/[{;]/],c:!0},{a:"js css",g:"bracket",i:[/\(\s*(var|let|const)?\s*/],k:[/\)/],c:!0,l:!0,e:!0},{a:"js",g:"dot-chain",i:[/^\.[A-Za-z$_]/],k:[/[\.;]/],c:!0,j:!0,b:-1},{a:"js",g:"dot-chain",i:[/\.\s*\r*\n/],k:[/[\.;]/,/[^\s]\s*\r*\n/],c:!0},{a:"js css",g:"array",i:[/\[/],k:[/]/],c:!0,l:!0,e:!0},{a:"js css",g:"block",i:[/\{/],k:[/}/],c:!0,l:!0,e:!0},{a:"js",g:"var/let/const",i:[/(var|let|const)[\s]*\r*\n/],k:[i],c:!0,f:!0},{a:"js",g:"var/let/const",i:[/(var|let|const)\s+(?=[\w$])/],k:[/[,;=]/,i],c:!0},{a:"js",g:"var/let/const",h:["var/let/const","="],i:[/,[\s]*\r*\n/],k:[/[,;]/,i],c:!0,callback:l},{a:"js",g:"var/let/const",h:["var/let/const","="],i:[/^,/],k:[/[,;]/,i],j:!0,c:!0,b:-1,callback:l},{a:"js",g:"equality",i:[/[=<>!]=(=)?/],k:[/./]},{a:"js",g:"=",i:[/=/],k:[/[,;\)\]}]/,h]},{a:"js",g:"?:",i:[/\?/],k:[/[:;]/],f:!0,c:!0},{a:"js",g:"case",i:[/^(case|default)[\s:]/],k:[/break[\s;\r\n]/,/^return[\s;\r\n]/,/^case[\s]+/,/^default[\s:]/,/}/],f:function(n){return n.endPatternIndex<=1},c:!0,e:!0},{a:"js",g:"semicolon",i:[/;/],k:[/./]}],f=e("css",g),d=e("js",g),m=e("html",g),x={css:function(n,e){return t(n||"",f,void 0===e?"\t":e)},js:function(n,e){return t(n||"",d,void 0===e?"\t":e)},html:function(n,e){return t(n||"",m,void 0===e?"\t":e)},indentJS:function(n,e){return console&&console.warn&&console.warn("Calling deprecated function!"),x.js(n,e)},indentCSS:function(n,e){return console&&console.warn&&console.warn("Calling deprecated function!"),x.css(n,e)},indentHTML:function(n,e){return console&&console.warn&&console.warn("Calling deprecated function!"),x.html(n,e)}};return x}(this);return n});