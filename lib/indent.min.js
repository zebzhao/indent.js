!function(n,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():n.indent=e()}(this,function(){var n=function(n){function e(n,e){if(u[n])return u[n];var s=[];u[n]=s;for(var t=0;t<e.length;t++)e[t].langs.indexOf(n.toLowerCase())!=-1&&s.push(e[t]);return s}function s(n,s,c){function i(n){O=n.cursor;var s=n.rule,t=A+1+(s.lineOffset||0);n.line=t,y.push(n),s.debug,s.indent&&b[t]++,s.rules&&(z=e(s.rules)),s.scope&&k.push(null),s.callback&&s.callback(n,b,w)}function u(){var n=y.pop(),e=n.line,s=n.rule;if(s.debug,s.indent){var t=s.endsIndent||0!==m.matchIndex?1:0;w[A+t]&&w[A+t].push(e)}s.rules&&(z=null),s.scope&&k.pop(),k[k.length-1]=n}function g(n,e,s){n=n.substring(s,n.length);for(var t,a,r,l=null,c=n.length,i=k[k.length-1],d=i?i.rule.name:"",u=0;u<e.length;u++)r=e[u],(!r.lastRule||d&&r.lastRule.indexOf(d)!==-1)&&(a=o(n,r.starts,r),a.matchIndex!=-1&&a.matchIndex<c&&(!r.head||0==s)&&(c=a.matchIndex,t=a,l=r));return{rule:l,relativeIndex:l?c:-1,matchIndex:l?c+s:-1,cursor:l?s+t.cursor:-1,state:a.state,lastMatch:i}}for(var m,h,f,v,x,p=n.split(/[\r]?\n/gi),I=p.length,j=a(I),b=a(I),w=t(I),y=[],k=[null],A=0,O=0,z=null;A<I;){if(f=p[A].trim(),v=l(f)+"\r\n",x=y[y.length-1],h=g(v,z||s,O),y.length)if(m=d(v,x,O,h),m.matchIndex==-1){if(x.rule.ignore){j[A]=1,A++,O=0;continue}}else if(x.rule.ignore||h.matchIndex==-1||m.matchIndex<=h.matchIndex){u(),O=m.cursor;continue}h.matchIndex!=-1?i(h):(A++,O=0)}console.log(w),console.log(b),console.log(j);var Z,R,C,M,S,$,E=0,L=b.slice(),H=a(I),J=[];for(S=0;S<I;S++){for(R=w[S],M=0,$=0;$<R.length;$++)C=R[$],C<0?-C!==S&&(H[-C]++,M+=1):L[C]>0&&(L[C]--,M+=C!==S);Z=L[S],H[S]=Z>M?1:Z<M?Z-M:0,L[S]=Z>0?1:0}for(S=0;S<I;S++)0===j[S]?(E+=H[S]||0,J.push((E>0?r(c,E):"")+p[S].trim())):J.push(p[S]);return console.log(L),console.log(H),J.join("\r\n")}function t(n){for(var e=new Array(n),s=0;s<n;s++)e[s]=[];return e}function a(e){if(n.Int16Array)return new Int16Array(e);for(var s=new Array(e),t=0;t<e;t++)s[t]=0;return s}function r(n,e){return new Array(e+1).join(n)}function l(n){return n.replace(/\\(u[0-9A-Za-z]{4}|u\{[0-9A-Za-z]{1,6}]\}|x[0-9A-Za-z]{2}|.)/g,"0")}function c(n,e,s){var t=n.lastMatch;t&&"="===t.rule.name&&s[n.line].push(-t.line)}function i(n,e,s,t){var a;if(s.newline){if(a=n.search(/[;,=]?\r*\n/),a!==-1)return{matchIndex:a,length:1}}else a=n.search(/[^\s\r\n\{\(\[]/),s.newline=a!==-1&&(a<=t.relativeIndex||t.relativeIndex===-1);return null}function d(n,e,s,t){n=n.substr(s,n.length);var a=e.rule,r=o(n,a.ends,a,e.state,t),l=a.advance?r.cursor:r.matchIndex;return{matchIndex:r.matchIndex===-1?-1:r.matchIndex+s,cursor:l==-1?-1:l+s,state:r.state}}function o(n,e,s,t,a){t=t||{};for(var r,l,c=-1,i=0,d=0;d<e.length;d++)if(l=e[d],"function"==typeof l){if(r=l(n,s,t,a)){c=r.matchIndex,i=r.length;break}}else if(r=n.match(l)){c=n.search(l),i=r[0].length;break}return{matchIndex:c,cursor:c+i,state:t}}var u={},g=/\r*\n/,m=/;/,h=[{langs:"html",name:"comment",starts:[/\<\!\-\-/],ends:[/\-\-\>/],ignore:!0,advance:!0},{langs:"html",name:"doctype",starts:[/\<\!doctype html>/i],ends:[g],ignore:!0,advance:!0},{langs:"html",name:"link|br|hr|input|img|meta",starts:[/\<(link|br|hr|input|img|meta)/i],ends:[/>/],advance:!0},{langs:"html",name:"mode switch js",starts:[function(n){var e=/<script[\s>].*/i,s=/<\/script>/i,t=e.exec(n),a=s.exec(n);return t&&(!a||a.index<t.index)?{matchIndex:t.index,length:t[0].length}:null}],ends:[/<\/script>/i],rules:"js",advance:!0,indent:!0,scope:!0},{langs:"html",name:"mode switch css",starts:[function(n){var e=/<style[\s>].*/i,s=/<\/style>/i,t=e.exec(n),a=s.exec(n);return t&&(!a||a.index<t.index)?{matchIndex:t.index,length:t[0].length}:null}],ends:[/<\/style>/i],rules:"css",advance:!0,indent:!0,scope:!0},{langs:"html",name:"close-tag",starts:[/<\/[A-Za-z0-9\-]+>/],ends:[/./],indent:!0},{langs:"html",name:"tag-attr",starts:[/<[A-Za-z0-9\-]+/],ends:[/>/],indent:!0},{langs:"html",name:"tag",starts:[/>/],ends:[/<\/[A-Za-z0-9\-]+>/],indent:!0,advance:!0},{langs:"js",name:"line-comment",starts:[/\/\//],ends:[g],ignore:!0},{langs:"js css",name:"block-comment",starts:[/\/\*/],ends:[/\*\//],ignore:!0},{langs:"js",name:"regex",starts:[function(n,e){var s=/[(,=:[!&|?{};][\s]*\/[^\/]|^[\s]*\/[^\/]/,t=n.search(s);if(t!=-1){t=n.indexOf("/",t);var a=n.substring(t+1),r=o(a,e.ends,e);if(r.matchIndex!=-1){a=a.substring(0,r.matchIndex);try{return new RegExp(a),{matchIndex:t,length:1}}catch(l){return null}}}return null}],ends:[function(n){for(var e=0,s=n.indexOf("/");s!=-1;)try{new RegExp(n.substring(0,s));break}catch(t){s=n.indexOf("/",e),e=s+1}return s==-1?null:{matchIndex:s,length:1}}],ignore:!0,advance:!0},{langs:"js css html",name:"string",starts:[/(''|""|``)/],ends:[/./,g]},{langs:"js css html",name:"string",starts:[/\"(?=[^"])/],ends:[/[^\\]\"/,g],ignore:!0,advance:!0},{langs:"js css html",name:"string",starts:[/\'(?=[^'])/],ends:[/[^\\]\'/,g],ignore:!0,advance:!0},{langs:"js css html",name:"string",starts:[/\`(?=[^`])/],ends:[/[^\\]\`/],ignore:!0,advance:!0},{langs:"js",name:"if",starts:[/^if\s*(?=\()/,/[\s]+if\s*(?=\()/],ends:[/else[\s]+/,i,/[{;]/],indent:!0,debug:!0},{langs:"js",name:"for",starts:[/^for\s*(?=\()/],ends:[i,/[{;]/],indent:!0},{langs:"js",name:"else",starts:[/else[\s]+/],ends:[/if[^\w$]/,i,/[{;]/],indent:!0},{langs:"js css",name:"bracket",starts:[/\(/],ends:[/\)/],indent:!0,advance:!0,scope:!0},{langs:"js",name:"dot-chain",starts:[/^\.[A-Za-z$_]/],ends:[/[\.;]/],indent:!0,head:!0,lineOffset:-1},{langs:"js",name:"dot-chain",starts:[/\.\s*\r*\n/],ends:[/[\.;]/,/[^\s]\s*\r*\n/],indent:!0},{langs:"js css",name:"array",starts:[/\[/],ends:[/]/],indent:!0,advance:!0,scope:!0},{langs:"js css",name:"block",starts:[/\{/],ends:[/}/],indent:!0,advance:!0,scope:!0},{langs:"js",name:"var/let/const",starts:[/(var|let|const)[\s]*\r*\n/],ends:[i],indent:!0,endsIndent:!0},{langs:"js",name:"var/let/const",starts:[/(var|let|const)\s+[\w$]+/],ends:[/[,;=]/,i],indent:!0},{langs:"js",name:"var/let/const",lastRule:["var/let/const","="],starts:[/,[\s]*\r*\n/],ends:[/[,;]/,i],indent:!0,callback:c},{langs:"js",name:"var/let/const",lastRule:["var/let/const","="],starts:[/^,/],ends:[/[,;]/,i],head:!0,indent:!0,lineOffset:-1,callback:c},{langs:"js",name:"=",starts:[/=/],ends:[/[,;]/,g]},{langs:"js",name:"case",starts:[/^case[\s]+/],ends:[/break[\s;]+/,/^case[\s]+/,/^default[\s]+/,/^return([\s]+|;)/,/}/],endsIndent:!0,indent:!0,scope:!0},{langs:"js",name:"default",starts:[/^default[\s]*:/],ends:[/break[\s;]+/,/^case[\s]+/,/^default[\s]+/,/^return([\s]+|;)/,/}/],endsIndent:!0,indent:!0,scope:!0},{langs:"js",name:"semicolon",starts:[m],ends:[/./]}],f=e("css",h),v=e("js",h),x=e("html",h),p={css:function(n,e){return s(n||"",f,void 0===e?"\t":e)},js:function(n,e){return s(n||"",v,void 0===e?"\t":e)},html:function(n,e){return s(n||"",x,void 0===e?"\t":e)},indentJS:function(n,e){return console&&console.warn&&console.warn("Calling deprecated function!"),p.js(n,e)},indentCSS:function(n,e){return console&&console.warn&&console.warn("Calling deprecated function!"),p.css(n,e)},indentHTML:function(n,e){return console&&console.warn&&console.warn("Calling deprecated function!"),p.html(n,e)}};return p}(this);return n});